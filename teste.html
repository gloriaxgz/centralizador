<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
  <title>Liberty AI - News Curator</title>

  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/fontawesome.css">
  <link rel="stylesheet" href="assets/css/templatemo-liberty-market.css">
  <link rel="stylesheet" href="assets/css/animate.css">

  <style>
    .news-card { background: #37393c; border-radius: 20px; padding: 25px; margin-bottom: 25px; border: 2px solid transparent; transition: 0.3s; cursor: pointer; position: relative; }
    .news-card:hover { border-color: #5d3cf2; background: #3e4044; }
    .news-card.selected { border-color: #5d3cf2; background: #282b2f; box-shadow: 0px 0px 15px rgba(93, 60, 242, 0.4); }
    
    .news-tag { display: inline-block; background: rgba(93, 60, 242, 0.2); color: #5d3cf2; padding: 4px 12px; border-radius: 10px; font-size: 11px; font-weight: 700; text-transform: uppercase; margin-right: 8px; margin-top: 10px; border: 1px solid #5d3cf2; }
    
    .select-badge { position: absolute; top: 20px; right: 20px; color: #5d3cf2; font-size: 20px; display: none; }
    .selected .select-badge { display: block; }

    .source-name { font-size: 12px; color: #aaa; margin-bottom: 8px; display: block; }
    .news-title { color: #fff; font-size: 18px; font-weight: 700; margin-bottom: 10px; }
    .news-snippet { color: #ccc; font-size: 14px; line-height: 1.5; }

    #floating-button { position: fixed; bottom: 30px; right: 30px; z-index: 1000; display: none; }
    
    /* Resumo Final Style */
    .summary-box { background: #1f2124; border-radius: 20px; padding: 40px; border: 1px dashed #5d3cf2; color: #ddd; margin-top: 50px; }
  </style>
</head>

<body>

  <header class="header-area header-sticky">
    <div class="container">
        <nav class="main-nav">
            <a href="index.html" class="logo"><img src="assets/images/logo.png" alt=""></a>
            <ul class="nav">
                <li><a href="index.html">Podcast</a></li>
                <li><a href="curadoria.html" class="active">Curadoria News</a></li>
            </ul>
        </nav>
    </div>
  </header>

  <div class="page-heading normal-space">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <h6>Tech Trends Radar</h6>
          <h2>Agregador de Notícias Inteligente</h2>
        </div>
      </div>
    </div>
  </div>

  <div class="item-details-page">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="section-heading">
            <div class="line-dec"></div>
            <h2>Pesquisar <em>Novidades</em></h2>
          </div>
          <div class="search-form" style="display: flex; gap: 15px; margin-bottom: 50px;">
            <input type="text" id="search-input" placeholder="Ex: Machine Learning, Quantum Computing..." 
                   style="background: #37393c; border: none; padding: 15px 25px; border-radius: 30px; color: #fff; width: 100%;">
            <button id="btn-search" class="orange-button" style="white-space: nowrap;">Buscar Notícias</button>
          </div>
        </div>

        <div class="col-lg-12" id="news-feed">
            </div>

        <div class="col-lg-12" id="summary-result-container" style="display: none;">
            <div class="section-heading"><div class="line-dec"></div><h2>AI <em>Executive Report</em></h2></div>
            <div class="summary-box" id="summary-content"></div>
        </div>
      </div>
    </div>
  </div>

  <div id="floating-button">
    <button id="btn-summarize" class="orange-button" style="background: #5d3cf2; border-color: #5d3cf2; box-shadow: 0 4px 15px rgba(0,0,0,0.5);">
        ✨ Resumir Selecionadas (<span id="select-count">0</span>)
    </button>
  </div>

  <script src="vendor/jquery/jquery.min.js"></script>
  
  <script>
    const GNEWS_KEY = 'SUA_KEY_AQUI'; 
    const OPENAI_KEY = 'SUA_KEY_AQUI';
    let selectedArticles = [];

    // 1. BUSCA AUTOMÁTICA DE NOTÍCIAS
    $('#btn-search').on('click', async function() {
        const query = $('#search-input').val();
        if(!query) return alert("Digite um termo!");

        $(this).text('Pesquisando...').prop('disabled', true);
        $('#news-feed').html('<p style="color:white; text-align:center;">Buscando e classificando notícias...</p>');
        $('#summary-result-container').hide();
        selectedArticles = [];
        updateFloatingButton();

        try {
            const response = await fetch(`https://gnews.io/api/v4/search?q=${query}&lang=en&max=6&token=${GNEWS_KEY}`);
            const data = await response.json();
            renderNews(data.articles);
        } catch (e) {
            alert("Erro ao buscar notícias.");
        } finally {
            $(this).text('Buscar Notícias').prop('disabled', false);
        }
    });

    // 2. RENDERIZAÇÃO E CLASSIFICAÇÃO COM IA
    async function renderNews(articles) {
        let html = '';
        $('#news-feed').empty();

        for (let art of articles) {
            // Chamamos a OpenAI rapidamente para gerar as TAGS de cada notícia
            const tags = await generateTags(art.title + " " + art.description);
            
            const card = `
                <div class="news-card" data-title="${art.title}" data-content="${art.description}" data-url="${art.url}">
                    <i class="fa fa-check-circle select-badge"></i>
                    <span class="source-name">${art.source.name}</span>
                    <h4 class="news-title">${art.title}</h4>
                    <p class="news-snippet">${art.description}</p>
                    <div class="tags-container">${tags}</div>
                </div>
            `;
            $('#news-feed').append(card);
        }
    }

    // Função para gerar Tags via OpenAI
    async function generateTags(text) {
        try {
            const res = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: { 'Authorization': 'Bearer ' + OPENAI_KEY, 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    model: "gpt-4o-mini", // Versão mini para ser mais rápido e barato
                    messages: [{ role: "system", content: "Analyze the news text and return 3 technical tags (e.g., AI, Cloud, Robotics). Format: tag1, tag2, tag3" },
                               { role: "user", content: text }],
                    temperature: 0
                })
            });
            const data = await res.json();
            const tagsArray = data.choices[0].message.content.split(',');
            return tagsArray.map(tag => `<span class="news-tag">${tag.trim()}</span>`).join('');
        } catch (e) { return '<span class="news-tag">Technology</span>'; }
    }

    // 3. SELEÇÃO DE CARDS
    $(document).on('click', '.news-card', function() {
        $(this).toggleClass('selected');
        const artData = {
            title: $(this).data('title'),
            content: $(this).data('content')
        };

        if ($(this).hasClass('selected')) {
            selectedArticles.push(artData);
        } else {
            selectedArticles = selectedArticles.filter(a => a.title !== artData.title);
        }
        updateFloatingButton();
    });

    function updateFloatingButton() {
        $('#select-count').text(selectedArticles.length);
        selectedArticles.length > 0 ? $('#floating-button').fadeIn() : $('#floating-button').fadeOut();
    }

    // 4. RESUMO FINAL (SEU PROMPT CALIBRADO)
    $('#btn-summarize').on('click', async function() {
        $(this).text('Generating AI Summary...').prop('disabled', true);
        $('#summary-result-container').show();
        $('#summary-content').html('Processing selected articles through Expert AI filter...');

        const fullText = selectedArticles.map(a => `TITLE: ${a.title}\nCONTENT: ${a.content}`).join('\n\n---\n\n');

        $.ajax({
            url: 'https://api.openai.com/v1/chat/completions',
            method: 'POST',
            headers: { 'Authorization': 'Bearer ' + OPENAI_KEY, 'Content-Type': 'application/json' },
            data: JSON.stringify({
                model: "gpt-4o",
                messages: [{
                    role: "user",
                    content: `Summarize the following articles using the following structure, as if you were presenting a news article in a very objective way:

                    TITLE
                    ** summary (2 to 3 lines) ** - Bullet 1 
                    - Bullet 2 
                    - Bullet 3 
                    - ... 
                    - Bullet N 

                    #### RULES: #### 
                    - Your only source must be the sent articles 
                    - There must be a max of 4 bullets with a max of 3 lines each 
                    - With the bullets, you must inform the most important topics of the news to Computer Science students and AI experts 

                    ## ARTICLES: ##
                    ${fullText}`
                }],
                temperature: 0.2
            }),
            success: function(response) {
                $('#summary-content').html(response.choices[0].message.content.replace(/\n/g, '<br>'));
                $('#btn-summarize').text('✨ Resumir Selecionadas').prop('disabled', false);
                $('html, body').animate({ scrollTop: $("#summary-result-container").offset().top - 50 }, 600);
            }
        });
    });
  </script>
</body>
</html>