<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
  <title>Podcast Radar Â· Radix</title>
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/fontawesome.css">
  <link rel="stylesheet" href="assets/css/templatemo-liberty-market.css">
  <link rel="stylesheet" href="assets/css/owl.css">
  <link rel="stylesheet" href="assets/css/animate.css">
  <link rel="stylesheet" href="assets/css/app.css">
</head>
<body>

  <div id="js-preloader" class="js-preloader">
    <div class="preloader-inner">
      <span class="dot"></span>
      <div class="dots"><span></span><span></span><span></span></div>
    </div>
  </div>

  <header class="header-area header-sticky">
    <div class="container">
      <div class="row"><div class="col-12">
        <nav class="main-nav">
          <a href="index.html" class="logo"><img src="assets/images/logo.png" alt="Radix"></a>
          <ul class="nav">
            <li><a href="index.html">Home</a></li>
            <li><a href="create.html">Transcritor de Podcast</a></li>
            <li><a href="details.html">News Radar</a></li>
            <li><a href="podcast.html" class="active">Podcast Radar</a></li>
            <li><a href="table.html">Newsboard</a></li>
          </ul>
          <a class="menu-trigger"><span>Menu</span></a>
        </nav>
      </div></div>
    </div>
  </header>

  <!-- Overlay do drawer -->
  <div id="drawer-overlay"></div>

  <!-- Drawer de episÃ³dios -->
  <div id="episode-drawer">
    <div class="drawer-header">
      <img id="drawer-thumb" src="" class="drawer-podcast-thumb" alt="">
      <div class="drawer-podcast-meta">
        <div id="drawer-name"   class="drawer-podcast-name">â€”</div>
        <div id="drawer-author" class="drawer-podcast-author">â€”</div>
      </div>
      <button class="drawer-close" id="drawer-close-btn" title="Fechar">âœ•</button>
    </div>
    <div class="drawer-search-bar">
      <input type="text" class="drawer-search" id="ep-filter"
             placeholder="Filtrar episÃ³dios..." oninput="filterEpisodes(this.value)">
    </div>
    <div class="drawer-body" id="drawer-body">
      <div class="state-box">
        <div class="spin"></div>
        <p style="margin-top:16px; font-size:13px;">Buscando episÃ³dios...</p>
      </div>
    </div>
  </div>

  <!-- ConteÃºdo principal -->
  <div class="page-heading normal-space">
    <div class="container"><div class="row"><div class="col-lg-12">
      <h2>Podcast Radar</h2>
      <p>Extraia e explore os links de notÃ­cias diretamente das descriÃ§Ãµes dos episÃ³dios</p>
    </div></div></div>
  </div>

  <div class="item-details-page">
    <div class="container">

      <!-- Config API -->
      <div class="row" style="padding-top:50px;">
        <div class="col-lg-12">
          <div class="api-config-banner">
            <div>
              <p><span>ğŸ”‘ Credenciais Podcast Index</span></p>
              <p style="font-size:12px; margin-top:4px; color:var(--muted);">
                Insira sua API Key e Secret do
                <a href="https://podcastindex.org" target="_blank" style="color:var(--amber);">podcastindex.org</a> (gratuito)
              </p>
            </div>
            <div class="config-inputs">
              <input type="text"     class="config-input" id="cfg-key"    placeholder="API Key"    autocomplete="off">
              <input type="password" class="config-input" id="cfg-secret" placeholder="API Secret" autocomplete="off">
              <button class="config-save-btn" onclick="saveCredentials()">Salvar</button>
            </div>
            <span id="cfg-status" style="font-size:12px; color:var(--muted);"></span>
          </div>
        </div>
      </div>

      <!-- Busca -->
      <div class="row">
        <div class="col-lg-12" style="padding-top:0;">
          <div class="section-heading">
            <div class="line-dec"></div>
            <h3>Encontre um Podcast</h3>
          </div>
          <div class="search-wrap">
            <input type="text" class="search-input" id="podcast-search"
                   placeholder="Ex: Lex Fridman, Huberman Lab, Tecnologia..."
                   onkeydown="if(event.key==='Enter') searchPodcasts()">
            <button class="search-btn" id="search-btn" onclick="searchPodcasts()">Buscar â†’</button>
          </div>
          <div id="search-status" style="font-size:13px; color:var(--muted); margin-top:14px; min-height:20px;"></div>
          <div id="podcast-results"></div>
        </div>
      </div>

      <!-- Feed de links -->
      <div class="row" id="news-feed-section" style="padding-top:20px; display:none;">
        <div class="col-lg-12">
          <hr class="divider">
          <div style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:12px; margin-bottom:8px;">
            <div class="section-heading" style="margin-bottom:0;">
              <div class="line-dec"></div>
              <h3>Links dos EpisÃ³dios</h3>
            </div>
            <button class="debug-toggle" onclick="toggleDebug()">ğŸ›  Debug</button>
          </div>
          <p style="color:var(--muted); font-size:14px; margin-bottom:16px;">
            Clique em um episÃ³dio na gaveta para extrair os links da descriÃ§Ã£o.
          </p>
          <div class="debug-panel" id="debug-panel"></div>
          <div id="episodes-content"></div>
        </div>
      </div>

    </div>
  </div>

  <div id="toast"></div>

  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
  <script src="assets/js/owl-carousel.js"></script>
  <script src="assets/js/app.js"></script>
  <script src="assets/js/custom.js"></script>

  <script>
  // â”€â”€ Estado â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let API_KEY    = localStorage.getItem('pi_key')    || '';
  let API_SECRET = localStorage.getItem('pi_secret') || '';
  let allEpisodes = [], selectedPodcast = null;
  let loadedEpisodes = {}, episodeCache = {};

  if (API_KEY)    document.getElementById('cfg-key').value    = 'â€¢â€¢â€¢â€¢â€¢â€¢';
  if (API_SECRET) document.getElementById('cfg-secret').value = 'â€¢â€¢â€¢â€¢â€¢â€¢';
  if (API_KEY && API_SECRET) document.getElementById('cfg-status').textContent = 'âœ“ Credenciais salvas';

  // â”€â”€ Debug â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function dbg(msg, type) {
    const panel = document.getElementById('debug-panel');
    const d = document.createElement('div');
    d.className = 'debug-line' + (type ? ' ' + type : '');
    d.textContent = '[' + new Date().toLocaleTimeString() + '] ' + msg;
    panel.appendChild(d);
    panel.scrollTop = panel.scrollHeight;
  }
  function toggleDebug() { document.getElementById('debug-panel').classList.toggle('visible'); }

  // â”€â”€ Credenciais â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function saveCredentials() {
    const k = document.getElementById('cfg-key').value.trim();
    const s = document.getElementById('cfg-secret').value.trim();
    if (!k || !s || k === 'â€¢â€¢â€¢â€¢â€¢â€¢') { showToast('Insira suas credenciais vÃ¡lidas.'); return; }
    API_KEY = k; API_SECRET = s;
    localStorage.setItem('pi_key', k);
    localStorage.setItem('pi_secret', s);
    document.getElementById('cfg-status').textContent = 'âœ“ Credenciais salvas';
    showToast('âœ“ Credenciais salvas!');
  }

  // â”€â”€ Auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function sha1(str) {
    const buf  = new TextEncoder().encode(str);
    const hash = await crypto.subtle.digest('SHA-1', buf);
    return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2,'0')).join('');
  }
  async function getAuthHeaders() {
    if (!API_KEY || !API_SECRET) throw new Error('NO_CREDENTIALS');
    const epoch = Math.floor(Date.now() / 1000).toString();
    const hash  = await sha1(API_KEY + API_SECRET + epoch);
    return { 'X-Auth-Key': API_KEY, 'X-Auth-Date': epoch, 'Authorization': hash, 'User-Agent': 'PodcastRadar/1.0' };
  }
  async function piGet(endpoint) {
    dbg('GET ' + endpoint);
    const headers = await getAuthHeaders();
    const res = await fetch('https://api.podcastindex.org/api/1.0' + endpoint, { headers });
    dbg('HTTP ' + res.status, res.ok ? 'ok' : 'err');
    if (!res.ok) throw new Error('HTTP ' + res.status);
    return res.json();
  }

  // â”€â”€ Busca de podcasts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function searchPodcasts() {
    const q = document.getElementById('podcast-search').value.trim();
    if (!q) return;
    if (!API_KEY || !API_SECRET) { showToast('âš ï¸ Configure suas credenciais primeiro!'); return; }

    const btn = document.getElementById('search-btn');
    btn.disabled = true; btn.textContent = 'â³';
    document.getElementById('search-status').textContent = 'Buscando podcasts...';
    document.getElementById('podcast-results').innerHTML = loadingSkeletonGrid(6);

    try {
      const data  = await piGet('/search/byterm?q=' + encodeURIComponent(q) + '&max=18');
      const feeds = data.feeds || [];
      document.getElementById('search-status').textContent =
        feeds.length ? feeds.length + ' podcast(s) encontrado(s)' : 'Nenhum resultado encontrado.';
      document.getElementById('podcast-results').innerHTML = feeds.length
        ? feeds.map(f => podcastCardHtml(f)).join('')
        : '<div style="grid-column:1/-1;"><div class="state-box"><div class="state-icon">ğŸ™ï¸</div><div class="state-title">Nenhum podcast encontrado</div></div></div>';
    } catch (e) {
      document.getElementById('search-status').textContent = 'âš ï¸ ' + (e.message === 'NO_CREDENTIALS' ? 'Configure suas credenciais!' : e.message);
      document.getElementById('podcast-results').innerHTML = '';
    } finally {
      btn.disabled = false; btn.textContent = 'Buscar â†’';
    }
  }

  function podcastCardHtml(f) {
    const thumb  = esc(f.artwork || f.image || 'assets/images/current-01.jpg');
    const author = esc(f.author || f.ownerName || 'Desconhecido');
    const count  = f.episodeCount ? f.episodeCount + ' episÃ³dios' : '';
    const title  = esc(f.title || 'Sem tÃ­tulo');
    return '<div class="podcast-card" onclick="selectPodcast(' + f.id + ', \'' + title.replace(/'/g,"\\'") + '\', \'' + author.replace(/'/g,"\\'") + '\', \'' + thumb.replace(/'/g,"\\'") + '\')">'
      + '<img src="' + thumb + '" class="podcast-thumb" onerror="this.src=\'assets/images/current-01.jpg\'" alt="">'
      + '<div class="podcast-info"><div class="podcast-title">' + title + '</div>'
      + '<div class="podcast-author">' + author + '</div>'
      + (count ? '<div class="podcast-ep-count">' + count + '</div>' : '')
      + '</div></div>';
  }

  // â”€â”€ Selecionar podcast + carregar episÃ³dios â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function selectPodcast(feedId, name, author, thumb) {
    selectedPodcast = { feedId, name, author, thumb };
    episodeCache    = {};

    document.querySelectorAll('.podcast-card').forEach(c => c.classList.remove('active'));
    event.currentTarget.classList.add('active');

    document.getElementById('drawer-name').textContent   = name;
    document.getElementById('drawer-author').textContent = author;
    const dThumb = document.getElementById('drawer-thumb');
    dThumb.src = thumb;
    dThumb.onerror = () => { dThumb.src = 'assets/images/current-01.jpg'; };
    document.getElementById('ep-filter').value = '';
    document.getElementById('drawer-overlay').classList.add('open');
    document.getElementById('episode-drawer').classList.add('open');
    document.body.style.overflow = 'hidden';

    document.getElementById('drawer-body').innerHTML =
      '<div class="state-box"><div class="spin"></div><p style="margin-top:16px;font-size:13px;">Carregando episÃ³dios...</p></div>';

    try {
      const data = await piGet('/episodes/byfeedid?id=' + feedId + '&max=40&fulltext=true');
      allEpisodes = (data.items || []).sort((a, b) => b.datePublished - a.datePublished);
      allEpisodes.forEach(ep => { episodeCache[ep.id] = ep; });
      renderEpisodeList(allEpisodes);
    } catch (e) {
      document.getElementById('drawer-body').innerHTML =
        '<div class="state-box"><div class="state-icon">âš ï¸</div><div class="state-title">Erro</div><div class="state-msg">' + esc(e.message) + '</div></div>';
    }
  }

  function renderEpisodeList(episodes) {
    document.getElementById('drawer-body').innerHTML = episodes.length
      ? episodes.map(ep => episodeItemHtml(ep)).join('')
      : '<div class="state-box"><div class="state-msg">Nenhum episÃ³dio encontrado.</div></div>';
  }

  function episodeItemHtml(ep) {
    const thumb = esc(ep.image || ep.feedImage || (selectedPodcast && selectedPodcast.thumb) || 'assets/images/current-01.jpg');
    const date  = ep.datePublished ? formatDate(ep.datePublished * 1000) : '';
    const dur   = ep.duration ? formatDuration(ep.duration) : '';
    const title = esc(ep.title || 'Sem tÃ­tulo');
    return '<div class="episode-item" onclick="loadEpisodeLinks(' + ep.id + ', \'' + title.replace(/'/g,"\\'") + '\', \'' + thumb.replace(/'/g,"\\'") + '\', ' + (ep.datePublished||0) + ')">'
      + '<img src="' + thumb + '" class="episode-thumb" onerror="this.src=\'assets/images/current-01.jpg\'" alt="">'
      + '<div class="episode-meta"><div class="episode-title-text">' + title + '</div>'
      + (date ? '<div class="episode-date">ğŸ“… ' + date + '</div>' : '')
      + (dur  ? '<div class="episode-duration">â± ' + dur + '</div>' : '')
      + '</div><span class="episode-arrow">â€º</span></div>';
  }

  function filterEpisodes(q) {
    renderEpisodeList(q ? allEpisodes.filter(e => (e.title||'').toLowerCase().includes(q.toLowerCase())) : allEpisodes);
  }

  // â”€â”€ Fechar drawer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('drawer-close-btn').onclick = closeDrawer;
  document.getElementById('drawer-overlay').onclick   = closeDrawer;
  function closeDrawer() {
    document.getElementById('episode-drawer').classList.remove('open');
    document.getElementById('drawer-overlay').classList.remove('open');
    document.body.style.overflow = '';
  }
  document.addEventListener('keydown', e => { if (e.key === 'Escape') closeDrawer(); });

  // â”€â”€ Carregar links de um episÃ³dio â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadEpisodeLinks(epId, epTitle, epThumb, datePublished) {
    closeDrawer();
    document.getElementById('news-feed-section').style.display = 'block';
    if (loadedEpisodes[epId]) { scrollToEpisode(epId); return; }

    const containerId     = 'ep-section-' + epId;
    const episodesContent = document.getElementById('episodes-content');

    if (!document.getElementById(containerId)) {
      const calDay = datePublished ? new Date(datePublished*1000).getDate() : 'â€”';
      const calMon = datePublished ? new Date(datePublished*1000).toLocaleDateString('pt-BR',{month:'short'}).replace('.','').toUpperCase() : '';
      const dateStr = datePublished ? formatDate(datePublished*1000) : 'â€”';
      episodesContent.insertAdjacentHTML('afterbegin',
        '<div class="episode-section" id="' + containerId + '">'
        + '<div class="episode-section-header">'
        + '<div class="ep-bar"></div>'
        + '<div class="ep-cal"><div class="ep-cal-top"><span>' + calMon + '</span></div><div class="ep-cal-day">' + calDay + '</div></div>'
        + '<div class="episode-section-meta"><div class="episode-section-title">' + dateStr + '</div>'
        + '<span class="episode-link-count">Extraindo...</span></div>'
        + '</div>'
        + '<div style="display:flex;gap:12px;align-items:center;padding:30px 0;color:var(--muted);font-size:14px;">'
        + '<div class="spin"></div> Extraindo links da descriÃ§Ã£o...'
        + '</div></div>');
    }

    setTimeout(() => scrollToEpisode(epId), 100);

    try {
      let descRaw = '';
      const cached = episodeCache[epId];
      if (cached) descRaw = cached.description || cached.content || cached.contentEncoded || cached.summary || '';

      if (!descRaw || descRaw.length < 10) {
        try {
          const data = await piGet('/episodes/byid?id=' + epId + '&fulltext=true');
          const ep   = data.episode || {};
          descRaw = ep.description || ep.content || ep.contentEncoded || ep.summary || ep.link || '';
        } catch (fetchErr) { dbg('/byid falhou: ' + fetchErr.message, 'err'); }
      }

      const links = extractLinks(descRaw);
      loadedEpisodes[epId] = links;
      renderEpisodeSection(epId, epTitle, epThumb, datePublished, links);
      showToast(links.length ? 'âœ“ ' + links.length + ' link(s) extraÃ­do(s)' : 'âš ï¸ Nenhum link encontrado');
    } catch (e) {
      const sec = document.getElementById(containerId);
      if (sec) sec.innerHTML = '<div class="state-box"><div class="state-icon">âš ï¸</div><div class="state-title">Erro</div><div class="state-msg">' + esc(e.message) + '</div></div>';
    }
  }

  // â”€â”€ ExtraÃ§Ã£o de links â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function extractLinks(rawContent) {
    if (!rawContent) return [];
    const results = [], seen = new Set();
    const parser  = new DOMParser();
    const doc     = parser.parseFromString(rawContent, 'text/html');

    doc.querySelectorAll('a[href]').forEach(a => {
      const href  = (a.getAttribute('href') || '').trim();
      const label = (a.textContent || a.title || '').trim();
      if (!href || seen.has(href) || !isNewsUrl(href)) return;
      seen.add(href);
      results.push({ url: href, title: label || slugToTitle(href), source: extractDomain(href), desc: getSurroundingText(doc, a) });
    });

    const urlRegex = /https?:\/\/([\w-]+\.)+[\w]{2,}(\/[\w\-._%~:/?#[\]@!$&'()*+,;=%]*)?/g;
    [(doc.body && doc.body.innerText) || '', rawContent].forEach(txt => {
      let m;
      while ((m = urlRegex.exec(txt)) !== null) {
        const href = m[0].replace(/[.,;:'")\]>]+$/, '');
        if (seen.has(href) || !isNewsUrl(href)) return;
        seen.add(href);
        results.push({ url: href, title: slugToTitle(href), source: extractDomain(href), desc: '' });
      }
    });

    dbg('Total links: ' + results.length);
    return results;
  }

  const SKIP_DOMAINS = new Set([
    'spotify.com','podcasts.apple.com','anchor.fm','buzzsprout.com','podcastindex.org',
    'listennotes.com','podchaser.com','pod.link','overcast.fm','pocketcasts.com',
    'castro.fm','player.fm','podcastaddict.com','breaker.audio',
    'twitter.com','x.com','instagram.com','facebook.com','youtube.com','youtu.be',
    'tiktok.com','linkedin.com','reddit.com','patreon.com','paypal.com','ko-fi.com',
    'substack.com','amzn.to','amazon.com','audible.com','apple.com',
    'linktr.ee','beacons.ai','bio.link','mailchimp.com','convertkit.com',
  ]);

  function isNewsUrl(url) {
    try {
      const u = new URL(url);
      if (u.protocol !== 'http:' && u.protocol !== 'https:') return false;
      const domain = u.hostname.replace(/^www\./, '');
      if (SKIP_DOMAINS.has(domain)) return false;
      if (u.pathname.replace(/\//g, '').length < 3) return false;
      return true;
    } catch (e) { return false; }
  }
  function extractDomain(url) { try { return new URL(url).hostname.replace(/^www\./, ''); } catch(e) { return url; } }
  function slugToTitle(url) {
    try {
      const parts = new URL(url).pathname.split('/').filter(Boolean);
      const slug  = parts[parts.length-1] || parts[parts.length-2] || '';
      return slug.replace(/[-_]/g,' ').replace(/\.[a-z0-9]+$/,'').replace(/\b\w/g,c=>c.toUpperCase()).trim() || extractDomain(url);
    } catch(e) { return url; }
  }
  function getSurroundingText(doc, anchor) {
    const parent = anchor.closest('p, li, blockquote, div, td');
    if (!parent) return '';
    const txt = (parent.textContent||'').trim();
    const at  = (anchor.textContent||'').trim();
    if (txt.length <= at.length + 5) return '';
    return txt.substring(0,180).trim() + (txt.length > 180 ? 'â€¦' : '');
  }

  // â”€â”€ Renderizar seÃ§Ã£o de episÃ³dio â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderEpisodeSection(epId, epTitle, epThumb, datePublished, links) {
    const section    = document.getElementById('ep-section-' + epId);
    if (!section) return;
    const carouselId = 'carousel-' + epId;
    const cardsHtml  = links.length
      ? links.map(l => newsCardHtml(l)).join('')
      : '<div class="carousel-slide"><div class="state-box"><div class="state-icon">ğŸ”</div><div class="state-title">Sem links</div><div class="state-msg">Nenhum link externo encontrado neste episÃ³dio.</div></div></div>';

    let calDay = 'â€”', calMon = '';
    if (datePublished) {
      const d = new Date(datePublished * 1000);
      calDay = d.getDate();
      calMon = d.toLocaleDateString('pt-BR',{month:'short'}).replace('.','').toUpperCase();
    }

    section.innerHTML =
      '<div class="episode-section-header">'
      + '<div class="ep-bar"></div>'
      + '<div class="ep-cal"><div class="ep-cal-top"><span>' + calMon + '</span></div><div class="ep-cal-day">' + calDay + '</div></div>'
      + '<div class="episode-section-meta">'
      + '<div class="episode-section-title">' + (datePublished ? formatDate(datePublished*1000) : 'â€”') + '</div>'
      + (links.length ? '<span class="episode-link-count">(' + links.length + ' links)</span>' : '')
      + '</div>'
      + '<div class="carousel-header-nav">'
      + '<button class="carousel-header-btn" onclick="scrollCarousel(\'' + carouselId + '\',-1)">&#8249;</button>'
      + '<button class="carousel-header-btn" onclick="scrollCarousel(\'' + carouselId + '\',1)">&#8250;</button>'
      + '</div></div>'
      + '<div class="news-carousel-wrap"><div class="news-carousel-inner" id="' + carouselId + '">' + cardsHtml + '</div></div>';
  }

  function newsCardHtml(link) {
    const title  = esc(link.title  || link.source);
    const source = '@' + esc((link.source||'').toUpperCase());
    const url    = esc(link.url);
    const letter = (link.source || '?').charAt(0).toUpperCase();
    const tag    = guessTag(link.source, link.title);
    return '<div class="carousel-slide">'
      + '<div class="news-card" onclick="window.open(\'' + url + '\',\'_blank\')">'
      + '<div class="news-card-img-wrap no-img"><span>' + letter + '</span></div>'
      + '<div class="news-card-body">'
      + '<div class="news-card-title">' + title + '</div>'
      + '<span class="news-card-source">' + source + '</span>'
      + (link.desc ? '<p class="news-card-desc">' + esc(link.desc) + '</p>' : '')
      + '<span class="news-card-tag">' + tag + '</span>'
      + '</div></div></div>';
  }

  function guessTag(source, title) {
    const text = ((source||'') + ' ' + (title||'')).toLowerCase();
    if (/nvidia|gpu|chip|amd|intel/.test(text))    return 'HARDWARE';
    if (/hack|cyber|security|seguranÃ§a/.test(text)) return 'CYBER';
    if (/gpt|openai|gemini|llm|claude|ia|ai/.test(text)) return 'AI';
    if (/oil|gas|petro|energy/.test(text))          return 'ENERGY';
    if (/finance|invest|market|stock/.test(text))   return 'FINANCE';
    return 'TECH';
  }

  function scrollCarousel(id, dir) {
    const el = document.getElementById(id);
    if (el) el.scrollBy({ left: dir * 320, behavior: 'smooth' });
  }

  // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function scrollToEpisode(epId) {
    const el = document.getElementById('ep-section-' + epId);
    if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
  function formatDate(ts) { return new Date(ts).toLocaleDateString('pt-BR',{day:'2-digit',month:'long',year:'numeric'}); }
  function formatDuration(secs) {
    if (!secs) return '';
    const h = Math.floor(secs/3600), m = Math.floor((secs%3600)/60);
    return h ? h + 'h ' + m + 'min' : m + 'min';
  }
  function esc(str) {
    return String(str||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }
  function loadingSkeletonGrid(n) {
    const card = '<div style="background:var(--bg-card);border-radius:16px;padding:18px;display:flex;gap:14px;">'
      + '<div class="skeleton sk-block"></div>'
      + '<div style="flex:1"><div class="skeleton sk-line"></div><div class="skeleton sk-line short"></div></div></div>';
    let out = '<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:18px;margin-top:30px;grid-column:1/-1;">';
    for (let i = 0; i < n; i++) out += card;
    return out + '</div>';
  }
  </script>
</body>
</html>
